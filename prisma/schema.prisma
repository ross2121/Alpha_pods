// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                    String  @id @unique @default(uuid())
  telegram_id           String  @unique
  name                  String
  public_key            String  @unique
  role                  Role
  encrypted_private_key String
  encryption_iv         String
  deposits     Deposit[] 
}

model Proposal {
  id             String   @id @unique @default(uuid())
  mint           String
  amount         Float
  yes            Int
  no             Int
 Strategy       Strategy?
  Lowerbound       Int?
  Upperbound       Int?
  Type_Strategy    Type_Strategy?
  Liquidty_Distribution  String?
  messagId       BigInt
  chatId         BigInt
  createdAt      BigInt
  requestId      String?
  Txn            String?
  mintb          String?
  Votestatus     Status
  ProposalStatus Status
  Members        String[]
  @@unique([chatId, messagId])
}

enum  Strategy{
  Simple
  Complex
  Custom
}
enum Type_Strategy{
  spotBalanced
  bidAskBalanced
  curveBalanced
  
}
enum Status {
  Expired
  Running
}

model Escrow {
  id                String              @id @unique @default(uuid())
  escrow_pda        String              @unique
  chatId            BigInt              @unique
  seed              String
  creator_pubkey    String
  deposits          Deposit[]
  liquidityPositions LiquidityPosition[]
}

model Deposit {
  id        String @id @unique @default(uuid())
  telegram_id String
  amount    Float
  mint      String?
  escrowId  String
    userId      String
  escrow    Escrow @relation(fields: [escrowId], references: [id])
  user        User    @relation(fields: [userId], references: [id])
 
  @@unique([telegram_id, escrowId, mint])
}

model LiquidityPosition {
  id              String   @id @unique @default(uuid())
  positionAddress String   @unique
  poolAddress     String
  tokenMint       String
  amount          String
  chatId          BigInt
  Strategy        Strategy
  escrowId        String
  lowerBinId      Int
  upperBinId      Int
  isActive        Boolean  @default(true)
  createdAt       DateTime @default(now())
  closedAt        DateTime?
  escrow          Escrow   @relation(fields: [escrowId], references: [id])
}


enum Role {
  admin
  user
}